{% extends "base.html" %}
{% block content %}
<h1>Students</h1>
<div class="grid grid-2">
  <div class="card">
    <h3>Add Student</h3>
    <form method="post">
      <input name="roll_no" placeholder="Roll No" required>
      <input name="name" placeholder="Full Name" required>
      <label>Branch</label>
      <select name="branch" required>
        <option value="">Select branch</option>
        {% for b in branch_choices %}<option value="{{ b }}">{{ b }}</option>{% endfor %}
      </select>
      <label>Current semester</label>
      <select name="current_semester" required>
        <option value="">Select semester</option>
        {% for s in range(1, 9) %}<option value="{{ s }}">{{ s }}</option>{% endfor %}
      </select>
      <input name="resume_link" placeholder="Resume Link (Drive/Dropbox URL)">
      <label>Eligibility Status</label>
      <select name="eligibility_status">
        <option value="ELIGIBLE">ELIGIBLE</option>
        <option value="EXTERNAL_INTERN">EXTERNAL_INTERN</option>
        <option value="CAMPUS_INTERN">CAMPUS_INTERN</option>
        <option value="EXTERNAL_PLACED">EXTERNAL_PLACED</option>
        <option value="BLOCKED_BY_POLICY">BLOCKED_BY_POLICY</option>
      </select>
      <input name="block_reason" placeholder="Block note (optional)">
      <label><input type="checkbox" name="is_lateral_entry"> Lateral Entry (starts from semester 3)</label>
      <button type="submit">Add Student</button>
    </form>
  </div>
  <div class="card">
    <h3>Resume Link Mode</h3>
    <p>Store resume as URL (Google Drive/OneDrive/etc). Export will include this link per student.</p>
  </div>
</div>

<h3>Student List</h3>
<table>
  <thead>
    <tr>
      <th>Roll</th>
      <th>Name</th>
      <th>Branch</th>
      <th>Lateral</th>
      <th>Sem</th>
      <th>CGPA</th>
      <th>Backlogs</th>
      <th>Eligibility</th>
      <th>Resume Link</th>
      <th>Update Resume Link</th>
      <th>Update Eligibility</th>
      <th>Update Backlog</th>
    </tr>
  </thead>
  <tbody>
    {% for s in students %}
    <tr>
      <td>{{ s.roll_no }}</td>
      <td>{{ s.name }}</td>
      <td>{{ s.branch }}</td>
      <td>{{ "Yes" if s.is_lateral_entry else "No" }}</td>
      <td>{{ s.current_semester }}</td>
      <td>{{ s.cgpa }}</td>
      <td>{{ s.total_backlogs }}</td>
      <td>{{ s.eligibility_status }}{% if s.block_reason %}<br><small>{{ s.block_reason }}</small>{% endif %}</td>
      <td>{{ s.resume_link or "Not set" }}</td>
      <td>
        <form action="{{ url_for('update_resume_link', student_id=s.id) }}" method="post">
          <input name="resume_link" placeholder="https://..." required>
          <button type="submit">Save Link</button>
        </form>
      </td>
      <td>
        <form action="{{ url_for('update_eligibility_status', student_id=s.id) }}" method="post">
          <select name="eligibility_status" required>
            <option value="ELIGIBLE">ELIGIBLE</option>
            <option value="EXTERNAL_INTERN">EXTERNAL_INTERN</option>
            <option value="CAMPUS_INTERN">CAMPUS_INTERN</option>
            <option value="EXTERNAL_PLACED">EXTERNAL_PLACED</option>
            <option value="BLOCKED_BY_POLICY">BLOCKED_BY_POLICY</option>
          </select>
          <input name="block_reason" placeholder="Reason (optional)">
          <button type="submit">Update</button>
        </form>
      </td>
      <td>
        <form action="{{ url_for('update_backlog', student_id=s.id) }}" method="post">
          <input type="number" name="semester_no" min="1" max="8" placeholder="Semester" required>
          <input type="number" name="new_backlog" min="0" placeholder="New backlog count" required>
          <input name="note" placeholder="Reason (optional)">
          <button type="submit">Update</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
